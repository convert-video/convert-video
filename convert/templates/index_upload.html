<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css"
          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <title>Video Upload with Subtitle Options</title>
    <style>
        pre {
            background-color: #f4f4f4;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>

<body>
<div class="container-fluid" style="margin: 50px;" id="main-body">
    <h1>Upload Video and Subtitle Options</h1>

    <form id="uploadForm">

        <div class="form-group">
            <label for="videoFile">Select Video File:</label><br>
            <input type="file" id="videoFile" name="file" accept="video/*"><br><br>
        </div>

        <div class="form-group">
            <div>
                <label for="transcriptFile">Select Transcript File (Text):</label><br>
                <input type="file" id="transcriptFile" name="transcript" accept=".txt"><br><br>
            </div>

            <div>
                <label for="translationFile">Select Translated Text File (Text):</label><br>
                <input type="file" id="translationFile" name="translation" accept=".txt"><br><br>
            </div>

            <div class="form-group">
                <label for="fontFile">Select Font File (TTF):</label><br>
                <input type="file" id="fontFile" name="font" accept=".ttf"><br><br>
            </div>

            <div class="form-group">
                <label for="fontSize">Font Size:</label><br>
                <input type="number" id="fontSize" name="font_size" min="1"><br><br>
            </div>

            <div class="form-group">
                <label for="fontColor">Font Color (Hex):</label><br>
                <input type="color" id="fontColor" name="font_color" value="#000000"><br><br>
            </div>

            <div class="form-group">
                <label for="boxColor">Subtitle Box Color (Hex):</label><br>
                <input type="color" id="boxColor" name="box_color" value="#FFFFFF"><br><br>
            </div>

            <div class="form-group">
                <label for="boxSizeWidth">Subtitle Box Width:</label><br>
                <input type="number" id="boxSizeWidth" name="box_size" min="1"><br><br>
            </div>

            <div class="form-group">
                <label for="boxSizeHeight">Subtitle Box Height:</label><br>
                <input type="number" id="boxSizeHeight" name="box_size" min="1"><br><br>
            </div>

            <div class="form-group">
                <label for="elevenLabsApi">Eleven Labs API Key:</label><br>
                <input type="text" id="elevenLabsApi" name="elevenLabsApi"><br><br>
            </div>

            <div class="form-group">
                <label for="voiceId">Voice ID:</label><br>
                <input type="text" id="voiceId" name="voiceId"><br><br>
            </div>
            <button type="submit" class="btn btn-primary">Upload</button>
    </form>
</div>

<div id="loadingSection" class="margin: 50px;">
    <p id="process-video-message"> processing video............ </p>
</div>

<div id="downloadLink">
    <p> The video is fully processed, please use the link below to download the video. </p>
    <a id="download" href="/download">Download Processed Video</a>
    <p id="videoinfo"></p>
    <br>
    <p id="json_data"></p>
</div>


<script>
    const baseUrl = window.location.origin;
    document.getElementById("downloadLink").style.display = "none";

    document.getElementById("uploadForm").addEventListener("submit", async function (event) {
        event.preventDefault();
        console.log(event)
        document.getElementById("main-body").style.display = "block";

        const videoFile = document.getElementById("videoFile").files[0];
        const transcriptFile = document.getElementById("transcriptFile").files[0];
        const translationFile = document.getElementById("translationFile").files[0];
        const fontFile = document.getElementById("fontFile").files[0];
        const fontSize = document.getElementById("fontSize").value;
        const fontColor = document.getElementById("fontColor").value;
        const boxColor = document.getElementById("boxColor").value;
        const boxSizeWidth = document.getElementById("boxSizeWidth").value;
        const boxSizeHeight = document.getElementById("boxSizeHeight").value;
        const elevenLabsApi = document.getElementById("elevenLabsApi").value;
        const voiceId = document.getElementById("voiceId").value;

        // Create FormData object to hold the file and metadata
        const formData = new FormData();
        formData.append("file", videoFile);
        formData.append("transcript", transcriptFile);
        formData.append("translation", translationFile);
        formData.append("font", fontFile);
        formData.append("font_size", fontSize);
        formData.append("font_color", fontColor);
        formData.append("box_color", boxColor);
        formData.append("box_width", boxSizeWidth);
        formData.append("box_height", boxSizeHeight);
        formData.append("eleven_labs", elevenLabsApi);
        formData.append("voice_id", voiceId);

        document.getElementById("process-video-message").innerText = "processing video.....";

        try {
            // Make the POST request to the FastAPI backend
            const response = await fetch(`http://localhost:51560/upload-video/`, {
                method: "POST",
                body: formData
            });

            if (response.ok) {
                const result = await response.json();
                document.getElementById("downloadLink").style.display = "block";
                document.getElementById("download").href = "/download/" + result.video_info.video_id;
                document.getElementById("downloadLink").style.display = "block";
                document.getElementById("download").href = "/download/" + result.video_info.video_id;
                document.getElementById("videoinfo").innerText = result.video_info.video_name;
                document.getElementById("loadingSection").style.display = "block";
                document.getElementById("process-video-message").innerText = result.message;

                document.getElementById('json_data').innerHTML = `<pre>${JSON.stringify(result, null, 4)}</pre>`;
            } else {
                document.getElementById("loadingSection").style.display = "none";
                document.getElementById("main-body").style.display = "block";
                document.getElementById("responseMessage").innerText = "Upload failed. Error: " + result.statusText;
            }
        } catch (error) {
            document.getElementById("loadingSection").style.display = "none";
            document.getElementById("responseMessage").innerText = "Upload failed. Error: " + error.message;
        }

    });
</script>
</body>

</html>